<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>مای ده - کشاورزی و هواشناسی</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {font-family: Tahoma, sans-serif; background:#f9fff9; margin:0; padding:0; direction:rtl;}
    header {background:#2e7d32; color:#fff; padding:15px; text-align:center;}
    section {padding:15px;}
    .article {background:#fff; margin:10px 0; padding:10px; border-radius:8px; box-shadow:0 0 5px #ccc;}
    .comments {margin-top:10px; padding:10px; background:#f0f0f0; border-radius:6px;}
    .admin-panel {background:#e8f5e9; margin-top:30px; padding:15px; border-top:2px solid #2e7d32;}
    .hidden {display:none;}
    button {padding:5px 10px; border:none; border-radius:5px; background:#2e7d32; color:#fff; cursor:pointer;}
    input, textarea {width:100%; margin:5px 0; padding:5px;}
  </style>
</head>
<body>
  <header>
    <h1>مای ده - کشاورزی و هواشناسی</h1>
  </header>

  <!-- بخش مقالات عمومی -->
  <section id="articles">
    <h2>مقالات</h2>
    <div id="articlesList"></div>
  </section>

  <!-- بخش هواشناسی -->
  <section id="weather">
    <h2>وضعیت هوا</h2>
    <input type="text" id="cityInput" placeholder="نام شهر را وارد کنید (فارسی یا انگلیسی)">
    <button onclick="getWeather()">جستجو</button>
    <div id="weatherResult"></div>
  </section>

  <!-- بخش ورود مدیر -->
  <section class="admin-panel">
    <h2>ورود مدیر</h2>
    <div id="loginForm">
      <input type="text" id="username" placeholder="نام کاربری">
      <input type="password" id="password" placeholder="رمز عبور">
      <button onclick="login()">ورود</button>
    </div>

    <div id="adminArea" class="hidden">
      <h3>مدیریت مقالات</h3>
      <input type="text" id="newTitle" placeholder="عنوان مقاله">
      <textarea id="newContent" placeholder="متن مقاله"></textarea>
      <button onclick="addArticle()">افزودن مقاله</button>
      <div id="adminArticles"></div>
    </div>
  </section>

  <script>
    // تنظیمات مدیر
    const admin = { username: "09163153189", password: "Mehdi13721#" };
    let loggedIn = false;

    // مقالات نمونه
    let articles = JSON.parse(localStorage.getItem("articles")) || [
      {title:"کشت خیار در اهواز", content:"خیار در اوایل مرداد کاشته می‌شود و حدود 40 روز بعد قابل برداشت است."},
      {title:"گوجه‌فرنگی در اهواز", content:"گوجه در روش سنتی جوی و پشته با آبیاری غرقابی کشت می‌شود."},
      {title:"پیاز در اهواز", content:"پیاز در پاییز کاشته می‌شود و در تابستان برداشت می‌گردد."}
    ];

    // نمایش مقالات
    function renderArticles(){
      const list = document.getElementById("articlesList");
      list.innerHTML = "";
      articles.forEach((a,i)=>{
        let div = document.createElement("div");
        div.className = "article";
        div.innerHTML = `<h3>${a.title}</h3><p>${a.content}</p>
          <div class="comments" id="comments-${i}">
            <h4>نظرات:</h4>
            <div id="commentList-${i}"></div>
            <input type="text" id="commentInput-${i}" placeholder="نظر شما">
            <button onclick="addComment(${i})">ارسال</button>
          </div>`;
        list.appendChild(div);
      });
      localStorage.setItem("articles", JSON.stringify(articles));
    }

    // افزودن نظر
    function addComment(index){
      const input = document.getElementById("commentInput-"+index);
      const list = document.getElementById("commentList-"+index);
      if(input.value.trim()!==""){
        let p = document.createElement("p");
        p.textContent = input.value;
        list.appendChild(p);
        input.value="";
      }
    }

    // ورود مدیر
    function login(){
      const u = document.getElementById("username").value;
      const p = document.getElementById("password").value;
      if(u===admin.username && p===admin.password){
        loggedIn=true;
        document.getElementById("loginForm").classList.add("hidden");
        document.getElementById("adminArea").classList.remove("hidden");
        renderAdminArticles();
      } else {
        alert("نام کاربری یا رمز اشتباه است");
      }
    }

    // افزودن مقاله
    function addArticle(){
      const t = document.getElementById("newTitle").value;
      const c = document.getElementById("newContent").value;
      if(t && c){
        articles.push({title:t, content:c});
        renderArticles();
        renderAdminArticles();
        document.getElementById("newTitle").value="";
        document.getElementById("newContent").value="";
      }
    }

    // نمایش مقالات در بخش مدیریت
    function renderAdminArticles(){
      const area = document.getElementById("adminArticles");
      area.innerHTML="";
      articles.forEach((a,i)=>{
        let div=document.createElement("div");
        div.innerHTML = `<b>${a.title}</b> 
          <button onclick="deleteArticle(${i})">حذف</button>`;
        area.appendChild(div);
      });
    }

    // حذف مقاله
    function deleteArticle(i){
      articles.splice(i,1);
      renderArticles();
      renderAdminArticles();
    }

    // هواشناسی
    async function getWeather(){
      const city=document.getElementById("cityInput").value;
      if(!city) return;
      const apiKey="dc9c93f51cdd375d459483c2a9f86d88";
      const url=`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric&lang=fa`;
      try{
        const res=await fetch(url);
        const data=await res.json();
        if(data.cod!==200){document.getElementById("weatherResult").innerText="یافت نشد"; return;}
        const windDir = getWindDirection(data.wind.deg);
        document.getElementById("weatherResult").innerHTML=
          `🌡 دما: ${data.main.temp}°C<br>
           💧 رطوبت: ${data.main.humidity}%<br>
           💨 باد: ${data.wind.speed} m/s (${windDir})<br>
           ☁ وضعیت: ${data.weather[0].description}`;
      } catch(e){
        document.getElementById("weatherResult").innerText="خطا در دریافت اطلاعات";
      }
    }

    // تبدیل زاویه باد به جهت اسمی
    function getWindDirection(deg){
      const dirs=["شمال","شمال‌شرقی","شرق","جنوب‌شرقی","جنوب","جنوب‌غربی","غرب","شمال‌غربی"];
      return dirs[Math.round(deg/45)%8];
    }

    renderArticles();
  </script>
</body>
</html>
